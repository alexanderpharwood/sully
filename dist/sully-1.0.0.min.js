!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):e.Sully=o()}(this,function(){"use strict";window.document||t("Sully requires a window with a document");var c={};function t(e){throw c.domContainer.innerHTML='<h3 id="exceptionMessage">'+c.exceptionMessage+"</h3>",new Error(e)}function s(){var e=window.location.search;if(""!==e)return e.substr(1,e.length)}function r(){var e,o=!1,t={};for(var r in t.route=(""===(e=c.html5Routing?window.location.pathname.replace(c.basePath,""):window.location.hash.substr(1,window.location.hash.length))&&(e=void 0),e),t.requestData={},void 0!==t.route&&""!==t.route||(t.route="/"),c.routeProvider){var n=c.routeProvider[r].route,i=n.match(/{(.*?)}/g),a=new RegExp("^"+n.replace(/{(.*?)}/g,"(.*?)").replace(new RegExp("/","g"),"\\/?")+"(/*)?$","g");if(null!=t.route.match(a)){var d=a.exec(t.route);t.controller=c.routeProvider[r].controller,t.method=c.routeProvider[r].method,t.middleware=c.routeProvider[r].middleware,t.route=r,o=!0}if(o)break}if(o){var u=1;for(var r in i){var l=i[r].substr(1,i[r].length-2);t.requestData[l]=d[u],u++}}else t.controller=c.notFoundRoute.controller,t.method=c.notFoundRoute.method,t.middleware=c.notFoundRoute.middleware;void 0!==s()&&(t.requestData.queryData=function(){var e=s();if(void 0!==e)return e.split("&").reduce(function(e,o){var t=o.split("=");return e[t[0]]=t[1],e},{})}()),function(e){if(void 0!==e.middleware&&e.middleware.constructor===Array)for(var o in e.middleware)c.middlewareProvider[e.middleware[o]].run(e.requestData);void 0!==c.controllerProvider[e.controller].constructor&&c.controllerProvider[e.controller].constructor(e.requestData),c.controllerProvider[e.controller][e.method](e.requestData)}(t)}return c.version="1.0.0",c.domContainer={},c.controllerProvider={},c.middlewareProvider={},c.viewProvider={},c.routeProvider={},c.notFoundRoute={},c.html5Routing=!1,c.exceptionMessage="Oops! An error occured processing your request.",c.routeTo=function(e){var o;c.html5Routing?window.history.pushState({},null,(o=e,(c.basePath+o).replace("//","/"))):window.location.hash=e,r()},c.registerNotFound=function(e,o){c.notFoundRoute.controller=e,c.notFoundRoute.method=o},c.registerView=function(e,o){c.viewProvider[e]=o},c.registerRoute=function(e){c.routeProvider[e.name]={route:e.route,controller:e.controller,method:e.method,middleware:e.middleware}},c.registerController=function(e,o){c.controllerProvider[e]=o},c.registerMiddleware=function(e,o){c.middlewareProvider[e]=o},c.getViewTemplate=function(e){return c.viewProvider[e]},c.renderView=function(e){void 0===e.template&&t("ERROR: view not found: "+e.view);var o=function e(o,t){var r=(o=o.replace(/(\r\n|\n|\r)/gm,"")).match(/{{(.*?)}}/g);for(var n in r){r[n]=r[n].substr(2,r[n].length-4),r[n].trim();var i=r[n].split(":",1)[0];switch(i){case"view":var a=c.viewProvider[r[n].substr(i.length+1,r[n].length)];o=o.replace("{{"+r[n]+"}}",e(a,t))}}return o}(e.template,void 0===e.data?{}:e.data);c.domContainer.innerHTML=o,e.viewDidLoad(),(void 0===e.scrollToTop||e.scrollToTop)&&(document.body.scrollTop=document.documentElement.scrollTop=0)},c.init=function(e){void 0===document.getElementsByTagName("base")[0]&&t("Missing <base> tag in html."),c.basePath=document.getElementsByTagName("base")[0].getAttribute("href"),c.interceptAnchorWithClass=e.interceptAnchorWithClass,c.domContainer=document.getElementById(e.container),void 0!==e.exceptionMessage&&(c.exceptionMessage=e.exceptionMessage),window.history&&history.pushState?(window.onpopstate=function(e){r()},window.history.replaceState({},null,window.location.path),c.html5Routing=!0):(window.onhashchange=function(){r()},c.html5Routing=!1),document.addEventListener("click",function(e){var o=e.path||e.composedPath&&e.composedPath()||e.deepPath();for(var t in o)if("A"===o[t].nodeName&&(void 0===c.interceptAnchorWithClass||o[t].classList.contains(c.interceptAnchorWithClass))){e.preventDefault();var r=o[t].getAttribute("href");c.routeTo(r)}}),r()},c});