!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):e.Sully=o()}(this,function(){"use strict";window.document||r("Sully requires a window with a document");var c={};function r(e){throw c.domContainer.innerHTML='<h3 id="exceptionMessage">'+c.exceptionMessage+"</h3>",new Error(e)}function n(e){return(c.basePath+e).replace("//","/")}function i(){var e,o=!1,r={};for(var t in r.route=function(){if("HASH"===c.routingMethod)e=window.location.hash.substr(1,window.location.hash.length);else var e=window.location.pathname.replace(c.basePath,"");return""===e&&(e=void 0),e}(),r.requestData={},void 0!==r.route&&""!==r.route||(r.route="/"),c.routeProvider){var n=c.routeProvider[t].route,i=n.match(/{(.*?)}/g),d=new RegExp("^"+n.replace(/{(.*?)}/g,"(.*?)").replace(new RegExp("/","g"),"\\/?")+"$","g");if(null!=r.route.match(d)){var a=d.exec(r.route);r.controller=c.routeProvider[t].controller,r.method=c.routeProvider[t].method,r.middleware=c.routeProvider[t].middleware,r.route=t,o=!0}if(o)break}if(o){var u=1;for(var t in i){var l=i[t].substr(1,i[t].length-2);r.requestData[l]=a[u],u++}}else r.controller=c.notFoundRoute.controller,r.method=c.notFoundRoute.method,r.middleware=c.notFoundRoute.middleware;void 0!==function(){var e;if(-1!==(e=window.location.hash.substr(1)).indexOf("/?"))return""===(e=e.substr(e.indexOf("/?")+1,e.length))?void 0:e}()&&(r.requestData.queryData=(e=(e=window.location.hash.substr(1)).substr(e.indexOf("?")+1,e.length)).split("&").reduce(function(e,o){var r=o.split("=");return e[r[0]]=r[1],e},{})),function(e){if(void 0!==e.middleware&&e.middleware.constructor===Array)for(var o in e.middleware)c.middlewareProvider[e.middleware[o]].run(e.requestData);void 0!==c.controllerProvider[e.controller].constructor&&c.controllerProvider[e.controller].constructor(e.requestData),c.controllerProvider[e.controller][e.method](e.requestData)}(r)}return c.production=!1,c.version="1.0.0",c.domContainer={},c.controllerProvider={},c.middlewareProvider={},c.viewProvider={},c.routeProvider={},c.notFoundRoute={},c.exceptionMessage="Oops! An error occured processing your request.",c.navigate=function(e){e.route,void 0!==e.queryData&&e.queryData;window.history.pushState({},null,n(e.route)),i()},c.registerNotFound=function(e,o){c.notFoundRoute.controller=e,c.notFoundRoute.method=o},c.registerView=function(e,o){c.viewProvider[e]=o},c.registerRoute=function(e){c.routeProvider[e.name]={route:e.route,controller:e.controller,method:e.method,middleware:e.middleware}},c.registerController=function(e,o){c.controllerProvider[e]=o},c.registerMiddleware=function(e,o){c.middlewareProvider[e]=o},c.getViewTemplate=function(e){return c.viewProvider[e]},c.renderView=function(e){void 0===e.template&&r("ERROR: view not found: "+e.view);var o=function e(o,r){var t=(o=o.replace(/(\r\n|\n|\r)/gm,"")).match(/{{(.*?)}}/g);for(var n in t){t[n]=t[n].substr(2,t[n].length-4),t[n].trim();var i=t[n].split(":",1)[0];switch(i){case"view":var d=c.viewProvider[t[n].substr(i.length+1,t[n].length)];o=o.replace("{{"+t[n]+"}}",e(d,r))}}return o}(e.template,void 0===e.data?{}:e.data);c.domContainer.innerHTML=o,e.viewDidLoad(),(void 0===e.scrollToTop||e.scrollToTop)&&(document.body.scrollTop=document.documentElement.scrollTop=0)},c.init=function(e){c.production||console.log("Sully.js, development version "+c.version),c.basePath=e.basePath,c.routingMethod=e.routingMethod,c.interceptAnchorWithClass=e.interceptAnchorWithClass,c.domContainer=document.getElementById(e.container),void 0!==e.exceptionMessage&&(c.exceptionMessage=e.exceptionMessage),"HISTORY"===c.routingMethod?window.history&&history.pushState?(window.onpopstate=function(e){i()},window.history.replaceState({},null,window.location.path)):r("Browser does not support routing method."):window.onhashchange=function(){i()},document.addEventListener("click",function(e){var o=e.path||e.composedPath&&e.composedPath()||e.deepPath();for(var r in o)if("A"===o[r].nodeName&&(void 0===c.interceptAnchorWithClass||o[r].classList.contains(c.interceptAnchorWithClass))){e.preventDefault();var t=o[r].getAttribute("href");return window.history.pushState({},null,n(t)),i(),!0}}),i()},c});