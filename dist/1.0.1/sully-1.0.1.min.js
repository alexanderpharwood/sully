!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):e.Sully=o()}(this,function(){"use strict";window.document||d("Sully requires a window with a document");var c={};function d(e){throw c.domContainer.innerHTML='<h3 id="exceptionMessage">'+c.exceptionMessage+"</h3>",new Error(e)}function o(e){return(c.basePath+e).replace("//","/")}function s(){var e=window.location.search;if(""!==e)return e.substr(1,e.length)}function r(){console.log(window.location.href);var e,o=!1,r={};for(var t in r.route=(""===(e=c.html5Routing?window.location.pathname.replace(c.basePath,""):window.location.hash.substr(1,window.location.hash.length))&&(e="/"),e),r.request={},r.request.url=window.location.href,void 0!==r.route&&""!==r.route||(r.route="/"),c.routeProvider){var n=c.routeProvider[t].route,i=n.match(/{(.*?)}/g),d=new RegExp("^"+n.replace(/{(.*?)}/g,"(.*?)").replace(new RegExp("/","g"),"\\/?")+"(/*)?$","g");if(null!=r.route.match(d)){var u=d.exec(r.route);r.controller=c.routeProvider[t].controller,r.method=c.routeProvider[t].method,r.middleware=c.routeProvider[t].middleware,r.route=t,o=!0}if(o)break}if(o){var a=1;for(var t in i){var l=i[t].substr(1,i[t].length-2);r.request[l]=u[a],a++}}else r.controller=c.notFoundRoute.controller,r.method=c.notFoundRoute.method,r.middleware=c.notFoundRoute.middleware;void 0!==s()&&(r.request.queryData=function(){var e=s();if(void 0!==e)return e.split("&").reduce(function(e,o){var r=o.split("=");return e[r[0]]=r[1],e},{})}()),function(e){if(void 0!==e.middleware&&e.middleware.constructor===Array)for(var o in e.middleware)c.middlewareProvider[e.middleware[o]].run(e.request);void 0!==c.controllerProvider[e.controller].constructor&&c.controllerProvider[e.controller].constructor(e.request),c.controllerProvider[e.controller][e.method](e.request)}(r)}return c.domContainer={},c.controllerProvider={},c.middlewareProvider={},c.viewProvider={},c.routeProvider={},c.notFoundRoute={},c.html5Routing=!1,c.exceptionMessage="Oops! An error occured processing your request.",c.routeTo=function(e){if(window.location.origin+o(e)===window.location.href)return!1;c.html5Routing?window.history.pushState({},null,o(e)):window.location.hash=e,r()},c.registerNotFound=function(e,o){c.notFoundRoute.controller=e,c.notFoundRoute.method=o},c.registerView=function(e,o){c.viewProvider[e]=o},c.registerRoute=function(e){c.routeProvider[e.name]={route:e.route,controller:e.controller,method:e.method,middleware:e.middleware}},c.registerController=function(e,o){c.controllerProvider[e]=o},c.registerMiddleware=function(e,o){c.middlewareProvider[e]=o},c.getView=function(e){return c.viewProvider[e]},String.prototype.buildView=function(e){return c.buildView(this,e)},c.buildView=function(e,o){void 0===e&&d("Template is undefined");var r=(e=e.replace(/(\r\n|\n|\r)/gm,"")).match(/{{(.*?)}}/g);for(var t in r){r[t]=r[t].substr(2,r[t].length-4),r[t].trim();var n=r[t].split(":",1)[0];switch(n){case"view":var i=c.viewProvider[r[t].substr(n.length+1,r[t].length)];e=e.replace("{{"+r[t]+"}}",c.buildView(i,o));break;default:e=e.replace("{{"+r[t]+"}}",void 0!==o[r[t]]?o[r[t]]:"")}}return e},c.renderView=function(e,o,r){void 0===e&&d("Template is undefined"),c.domContainer.innerHTML=e,(void 0===r||r)&&(document.body.scrollTop=document.documentElement.scrollTop=0),void 0!==o&&o&&o()},c.serveView=function(e,o,r,t){var n=c.getView(e);void 0===n&&d("View '"+e+"' not found"),n=c.buildView(n,o),c.renderView(n,r,t)},c.init=function(e){void 0===document.getElementsByTagName("base")[0]&&d("Missing <base> tag in html."),c.basePath=document.getElementsByTagName("base")[0].getAttribute("href"),c.domContainer=document.getElementById(e.container),void 0!==e.exceptionMessage&&(c.exceptionMessage=e.exceptionMessage),window.history&&history.pushState?(window.onpopstate=function(e){r()},window.history.replaceState({},null,window.location.path),c.html5Routing=!0):(window.onhashchange=function(){r()},c.html5Routing=!1),document.addEventListener("click",function(e){var o=e.path||e.composedPath&&e.composedPath()||e.deepPath();for(var r in o)if("A"===o[r].nodeName&&!o[r].classList.contains("no-route-catch")){e.preventDefault();var t=o[r].getAttribute("href");c.routeTo(t)}}),r()},c});