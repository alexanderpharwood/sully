!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):e.Sully=o()}(this,function(){"use strict";var s={};function d(e){throw s.domContainer.innerHTML='<h3 id="exceptionMessage">'+s.exceptionMessage+"</h3>",new Error(e)}function w(e){return(s.basePath+e).replace("//","/")}function m(){var e=window.location.search;if(""!==e)return e.substr(1,e.length)}function v(){return window.location.pathname.replace(s.basePath,"")}function h(){return window.location.hash.substr(1,window.location.hash.length)}function o(){var e=!1,o={};if(o.route=s.html5Routing?v():h(),s.html5Routing){if(""!==h()&&""===v()){var r="/"+h();return window.location.replace(window.location.origin+w(r))}}else if(""===h()&&""!==v()){var t="#/"+v();return window.location.replace(window.location.origin+w(t))}for(var n in o.request={},o.request.url=window.location.href,void 0!==o.route&&""!==o.route||(o.route="/"),s.routeProvider){var i=s.routeProvider[n].route,d=i.match(/{(.*?)}/g),u=new RegExp("^"+i.replace(/{(.*?)}/g,"(.*?)").replace(new RegExp("/","g"),"\\/?")+"(/*)?$","g");if(null!=o.route.match(u)){var a=u.exec(o.route);o.controller=s.routeProvider[n].controller,o.method=s.routeProvider[n].method,o.middleware=s.routeProvider[n].middleware,o.route=n,e=!0}if(e)break}if(e){var l=1;for(var n in d){var c=d[n].substr(1,d[n].length-2);o.request[c]=a[l],l++}}else o.controller=s.notFoundRoute.controller,o.method=s.notFoundRoute.method,o.middleware=s.notFoundRoute.middleware;void 0!==m()&&(o.request.queryData=function(){var e=m();if(void 0!==e)return e.split("&").reduce(function(e,o){var r=o.split("=");return e[r[0]]=r[1],e},{})}()),function(e){if(void 0!==e.middleware&&e.middleware.constructor===Array)for(var o in e.middleware)s.middlewareProvider[e.middleware[o]].run(e.request);void 0!==s.controllerProvider[e.controller].constructor&&s.controllerProvider[e.controller].constructor(e.request),s.controllerProvider[e.controller][e.method](e.request)}(o)}return s.domContainer={},s.controllerProvider={},s.middlewareProvider={},s.viewProvider={},s.routeProvider={},s.notFoundRoute={},s.html5Routing=!1,s.exceptionMessage="Oops! An error occured processing your request.",s.routeTo=function(e){if(window.location.origin+w(e)===window.location.href)return!1;s.html5Routing?window.history.pushState({},null,w(e)):window.location.hash=e,o()},s.registerNotFound=function(e,o){s.notFoundRoute.controller=e,s.notFoundRoute.method=o},s.registerView=function(e,o){s.viewProvider[e]=o},s.registerRoute=function(e){s.routeProvider[e.name]={route:e.route,controller:e.controller,method:e.method,middleware:e.middleware}},s.registerController=function(e,o){s.controllerProvider[e]=o},s.registerMiddleware=function(e,o){s.middlewareProvider[e]=o},s.getView=function(e){return s.viewProvider[e]},String.prototype.buildView=function(e){return s.buildView(this,e)},s.buildView=function(e,o){void 0===e&&d("Template is undefined");var r=(e=e.replace(/(\r\n|\n|\r)/gm,"")).match(/{{(.*?)}}/g);for(var t in r){r[t]=r[t].substr(2,r[t].length-4),r[t].trim();var n=r[t].split(":",1)[0];switch(n){case"view":var i=s.viewProvider[r[t].substr(n.length+1,r[t].length)];e=e.replace("{{"+r[t]+"}}",s.buildView(i,o));break;default:e=e.replace("{{"+r[t]+"}}",void 0!==o[r[t]]?o[r[t]]:"")}}return e},s.renderView=function(e,o,r){void 0===e&&d("Template is undefined"),s.domContainer.innerHTML=e,(void 0===r||r)&&(document.body.scrollTop=document.documentElement.scrollTop=0),void 0!==o&&o&&o()},s.serveView=function(e,o,r,t){var n=s.getView(e);void 0===n&&d("View '"+e+"' not found"),n=s.buildView(n,o),s.renderView(n,r,t)},s.init=function(e){window.document||d("Sully requires a window with a document"),void 0===document.getElementsByTagName("base")[0]&&d("Missing <base> tag in html."),s.basePath=document.getElementsByTagName("base")[0].getAttribute("href"),s.domContainer=document.getElementById(e.container),void 0!==e.exceptionMessage&&(s.exceptionMessage=e.exceptionMessage),window.history&&history.pushState?(window.onpopstate=function(e){o()},window.history.replaceState({},null,window.location.path),s.html5Routing=!0):(window.onhashchange=function(){o()},s.html5Routing=!1),document.addEventListener("click",function(e){var o=e.path||e.composedPath&&e.composedPath()||e.deepPath();for(var r in o)if("A"===o[r].nodeName&&!o[r].classList.contains("no-route-catch")){e.preventDefault();var t=o[r].getAttribute("href");s.routeTo(t)}}),o()},s});