!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):e.Sully=o()}(this,function(){"use strict";window.document||d("Sully requires a window with a document");var c={};function d(e){throw c.domContainer.innerHTML='<h3 id="exceptionMessage">'+c.exceptionMessage+"</h3>",new Error(e)}function s(){var e=window.location.search;if(""!==e)return e.substr(1,e.length)}function t(){var e,o=!1,t={};for(var r in t.route=(""===(e=c.html5Routing?window.location.pathname.replace(c.basePath,""):window.location.hash.substr(1,window.location.hash.length))&&(e=void 0),e),t.requestData={},void 0!==t.route&&""!==t.route||(t.route="/"),c.routeProvider){var n=c.routeProvider[r].route,i=n.match(/{(.*?)}/g),d=new RegExp("^"+n.replace(/{(.*?)}/g,"(.*?)").replace(new RegExp("/","g"),"\\/?")+"(/*)?$","g");if(null!=t.route.match(d)){var a=d.exec(t.route);t.controller=c.routeProvider[r].controller,t.method=c.routeProvider[r].method,t.middleware=c.routeProvider[r].middleware,t.route=r,o=!0}if(o)break}if(o){var u=1;for(var r in i){var l=i[r].substr(1,i[r].length-2);t.requestData[l]=a[u],u++}}else t.controller=c.notFoundRoute.controller,t.method=c.notFoundRoute.method,t.middleware=c.notFoundRoute.middleware;void 0!==s()&&(t.requestData.queryData=function(){var e=s();if(void 0!==e)return e.split("&").reduce(function(e,o){var t=o.split("=");return e[t[0]]=t[1],e},{})}()),function(e){if(void 0!==e.middleware&&e.middleware.constructor===Array)for(var o in e.middleware)c.middlewareProvider[e.middleware[o]].run(e.requestData);void 0!==c.controllerProvider[e.controller].constructor&&c.controllerProvider[e.controller].constructor(e.requestData),c.controllerProvider[e.controller][e.method](e.requestData)}(t)}return c.domContainer={},c.controllerProvider={},c.middlewareProvider={},c.viewProvider={},c.routeProvider={},c.notFoundRoute={},c.html5Routing=!1,c.exceptionMessage="Oops! An error occured processing your request.",c.routeTo=function(e){var o;c.html5Routing?window.history.pushState({},null,(o=e,(c.basePath+o).replace("//","/"))):window.location.hash=e,t()},c.registerNotFound=function(e,o){c.notFoundRoute.controller=e,c.notFoundRoute.method=o},c.registerView=function(e,o){c.viewProvider[e]=o},c.registerRoute=function(e){c.routeProvider[e.name]={route:e.route,controller:e.controller,method:e.method,middleware:e.middleware}},c.registerController=function(e,o){c.controllerProvider[e]=o},c.registerMiddleware=function(e,o){c.middlewareProvider[e]=o},c.getView=function(e){return c.viewProvider[e]},String.prototype.buildView=function(e){return c.buildView(this,e)},c.buildView=function(e,o){void 0===e&&d("Template is undefined");var t=(e=e.replace(/(\r\n|\n|\r)/gm,"")).match(/{{(.*?)}}/g);for(var r in t){t[r]=t[r].substr(2,t[r].length-4),t[r].trim();var n=t[r].split(":",1)[0];switch(n){case"view":var i=c.viewProvider[t[r].substr(n.length+1,t[r].length)];e=e.replace("{{"+t[r]+"}}",c.buildView(i,o));break;default:e=e.replace("{{"+t[r]+"}}",void 0!==o[t[r]]?o[t[r]]:"")}}return e},c.renderView=function(e,o,t){void 0===e&&d("Template is undefined"),c.domContainer.innerHTML=e,(void 0===t||t)&&(document.body.scrollTop=document.documentElement.scrollTop=0),void 0!==o&&o&&o()},c.serveView=function(e,o,t,r){var n=c.getView(e);void 0===n&&d("View '"+e+"' not found"),n=c.buildView(n,o),c.renderView(n,t,r)},c.init=function(e){void 0===document.getElementsByTagName("base")[0]&&d("Missing <base> tag in html."),c.basePath=document.getElementsByTagName("base")[0].getAttribute("href"),c.domContainer=document.getElementById(e.container),void 0!==e.exceptionMessage&&(c.exceptionMessage=e.exceptionMessage),window.history&&history.pushState?(window.onpopstate=function(e){t()},window.history.replaceState({},null,window.location.path),c.html5Routing=!0):(window.onhashchange=function(){t()},c.html5Routing=!1),document.addEventListener("click",function(e){var o=e.path||e.composedPath&&e.composedPath()||e.deepPath();for(var t in o)if("A"===o[t].nodeName&&!o[t].classList.contains("no-route-catch")){e.preventDefault();var r=o[t].getAttribute("href");c.routeTo(r)}}),t()},c});